futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, year)
futdf <- rbind(futdf, fooadd)
}
params <- newbrazilbase[newbrazilbase$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
View(futuredf)
i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, year)
futdf <- rbind(futdf, fooadd)
View(futuredf)
unique(brazil$intervention)
futuredf <- data.frame(intervention=c(rep("climate-critical protected areas", ccpaprojs),
rep("control climate-critical protected areas ", ccpaprojs),
rep("climate-smart forestry: manage", csfprojs),
rep("control climate-smart forestry: manage", csfprojs),
rep("climate-smart farming", csfprojs),
rep("control climate-smart farming", csfprojs),
rep("forest and wetland restoration", restoreprojs),
rep("control forest and wetland restoration", restoreprojs)))
ccpayears <- as.numeric(rep(c(2022:2031), each=round(((ccpaprojs)/10), digits=0)))
csfyears <- as.numeric(rep(c(2022:2031), each=round(((csfprojs)/10), digits=0)))
csfarmyears <- as.numeric(rep(c(2022:2031), each=round(((csfarmprojs)/10), digits=0)))
restoreyears <- as.numeric(rep(c(2022:2031), each=round(((restoreprojs)/10), digits=0)))
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
View(futuredf)
futuredf <- data.frame(intervention=c(rep("climate-critical protected areas", ccpaprojs),
rep("control climate-critical protected areas ", ccpaprojs),
rep("climate-smart forestry: manage", csfprojs),
rep("control climate-smart forestry: manage", csfprojs),
rep("climate-smart farming", csfprojs),
rep("control climate-smart farming", csfprojs),
rep("forest and wetland restoration", restoreprojs),
rep("control forest and wetland restoration", restoreprojs)))
ccpayears <- as.numeric(rep(c(2022:2031), each=round(((ccpaprojs)/10), digits=0)))
csfyears <- as.numeric(rep(c(2022:2031), each=round(((csfprojs)/10), digits=0)))
csfarmyears <- as.numeric(rep(c(2022:2031), each=round(((csfarmprojs)/10), digits=0)))
restoreyears <- as.numeric(rep(c(2022:2031), each=round(((restoreprojs)/10), digits=0)))
futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas")
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("control climate-critical protected areas"),
ccpayears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
runApp()
runApp()
runApp()
futuredf <- data.frame(intervention=c(rep("climate-critical protected areas", ccpaprojs),
rep("control climate-critical protected areas", ccpaprojs),
rep("climate-smart forestry: manage", csfprojs),
rep("control climate-smart forestry: manage", csfprojs),
rep("climate-smart farming", csfprojs),
rep("control climate-smart farming", csfprojs),
rep("forest and wetland restoration", restoreprojs),
rep("control forest and wetland restoration", restoreprojs)))
ccpayears <- as.numeric(rep(c(2022:2031), each=round(((ccpaprojs)/10), digits=0)))
csfyears <- as.numeric(rep(c(2022:2031), each=round(((csfprojs)/10), digits=0)))
csfarmyears <- as.numeric(rep(c(2022:2031), each=round(((csfarmprojs)/10), digits=0)))
restoreyears <- as.numeric(rep(c(2022:2031), each=round(((restoreprojs)/10), digits=0)))
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
futuredf$end <- futuredf$start + 4
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, year)
futdf <- rbind(futdf, fooadd)
}
params <- newbrazilbase[newbrazilbase$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
futdf <- futdf[complete.cases(futdf),]
for(i in c(1:nrow(futdf))){ #i=1
futdf$mst[i] <- rnorm(1, futdf$mst[i] + 0, 0.05)
futdf$pdsi[i] <- rnorm(1, futdf$pdsi[i] - 0, 0.05)
#futdf$pas[i] <- rnorm(1, futdf$pas[i], 0.1)
#futdf$numrds[i] <- rnorm(1, futdf$numrds[i], 50)
futdf$cost[i] <- 0 #+ ((futdf$start[i]-2020)*1000)
}
if(TRUE){
for(i in c(1:nrow(futdf))){
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-critical protected areas",
futdf$cost[i] + ((ccpainvest*1000000)/ccpaprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-smart forestry: manage",
futdf$cost[i] + ((csfinvest*1000000)/csfprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-smart farming",
futdf$cost[i] + ((csfarminvest*1000000)/csfarmprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="forest and wetland restoration",
futdf$cost[i] + ((restoreinvest*1000000)/restoreprojs),
futdf$cost[i])
}
}
brazil <- futdf[!duplicated(futdf),]
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control climate-critical protected areas", "control climate-smart forestry: manage",
"control climate-smart farming", "control forest and wetland restoration")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$accum.cost <- ave(brazil.stan$costperyr, brazil.stan$start, brazil.stan$end, brazil.stan$intervention,
FUN=cumsum)
#### Let's explore rate of temperature and precip changes
brazil.stan <- brazil.stan %>%
group_by(intervention, start, end, cost) %>%
arrange(year) %>%
dplyr::mutate(prevpdsi = lag(pdsi, default = first(pdsi))) %>%
dplyr::mutate(prevmst = lag(mst, default = first(mst)))
brazil.stan <- brazil.stan[brazil.stan$yrsofproject>0,]
brazil.stan$mstrate <- (brazil.stan$mst-brazil.stan$prevmst) ## Annual rate of change
brazil.stan$pdsirate <- (brazil.stan$pdsi-brazil.stan$prevpdsi) ## annual rate of change
brazilsub <- brazil.stan[brazil.stan$year <= brazil.stan$end,]
brazilsub$yrsofproject <- ifelse(brazilsub$intervention %in% controls, 0, brazilsub$yrsofproject)
brazilsub$yrs.z <- (brazilsub$yrsofproject-mean(brazilsub$yrsofproject,na.rm=TRUE))/(2*sd(brazilsub$yrsofproject,na.rm=TRUE))
brazilsub$mst.z <- (brazilsub$mst-mean(brazilsub$mst,na.rm=TRUE))/(2*sd(brazilsub$mst,na.rm=TRUE))
brazilsub$pdsi.z <- (brazilsub$pdsi-mean(brazilsub$pdsi,na.rm=TRUE))/(2*sd(brazilsub$pdsi,na.rm=TRUE))
brazilsub$rds.z <- (brazilsub$numrds-mean(brazilsub$numrds,na.rm=TRUE))/(2*sd(brazilsub$numrds,na.rm=TRUE))
brazilsub$elev.z <- (brazilsub$elev-mean(brazilsub$elev,na.rm=TRUE))/(2*sd(brazilsub$elev,na.rm=TRUE))
brazilsub$slope.z <- (brazilsub$slope-mean(brazilsub$slope,na.rm=TRUE))/(2*sd(brazilsub$slope,na.rm=TRUE))
brazilsub$pas.z <- (brazilsub$pas-mean(brazilsub$pas,na.rm=TRUE))/(2*sd(brazilsub$pas,na.rm=TRUE))
brazilsub$acc.cost.z <- (brazilsub$accum.cost-mean(brazilsub$accum.cost,na.rm=TRUE))/(2*sd(brazilsub$accum.cost,na.rm=TRUE))
brazilsub$mstrate.z <- (brazilsub$mstrate-mean(brazilsub$mstrate,na.rm=TRUE))/(2*sd(brazilsub$mstrate,na.rm=TRUE))
brazilsub$prate.z <- (brazilsub$pdsirate-mean(brazilsub$pdsirate,na.rm=TRUE))/(2*sd(brazilsub$pdsirate,na.rm=TRUE))
##### Predict response now instead with new data...
newdat <- brazilsub
mylist <- list(newdat)
fore <- newdat
preddata <- predict(mod1, fore, allow_new_levels=TRUE, probs=c(0.25, 0.75))
preddata <- as.data.frame(preddata)
fore <- cbind(fore, preddata)
fore$lc_ha_rate <- fore$Estimate
controls <- c("control climate-critical protected areas", "control climate-smart forestry: manage",
"control climate-smart farming", "control forest and wetland restoration")
fore$tx <- ifelse(fore$intervention%in%controls, 0, 1)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
"climate-critical protected areas", NA)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
"climate-smart forestry: manage", futuredf$int)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
"climate-smart farming", futuredf$int)
futuredf$int <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
"forest and wetland restoration", futuredf$int)
fore$costperint <- ave(fore$costperyr, fore$intervention, fore$year, FUN=sum)
cols <-viridis_pal(option="viridis")(4)
invest.fore <- ggplot(fore) +
geom_smooth(se=TRUE, aes(x=year, y=costperint/1000, col=int),
method="auto", level=0.5) +
theme_classic() + scale_color_manual(name="Intervention", values=cols,
labels=c("climate-critical protected areas"=
"climate-critical\nprotected areas",
"climate-smart farming"="cimate-smart\nfarming",
"climate-smart forestry:manage"="climate-smart\nforestry",
"forest and wetland restoration"="forest and\nwetland restoration")) +
ylab("Total investments ($1K)") + xlab("")
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=int)) +
geom_smooth(method="lm", level=0.5, aes(fill=int)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawinvest
View(fore)
fore$accumcost.mil <- fore$accum.cost/1000000
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=int)) +
geom_smooth(method="lm", level=0.5, aes(fill=int)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawinvest
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=intervention)) +
geom_smooth(method="lm", level=0.5, aes(fill=int)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawinvest
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=intervention)) +
geom_smooth(method="lm", level=0.5, aes(fill=intervention)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(brazilsub$intervention[brazilsub$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawinvest
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=intervention)) +
geom_smooth(method="lm", level=0.5, aes(fill=intervention)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawinvest
View(preddata)
runApp()
preddata <- predict(mod1, fore, allow_new_levels=TRUE, probs=c(0.25, 0.75), re_formula=NULL)
preddata <- as.data.frame(preddata)
fore <- cbind(fore, preddata)
fore$lc_ha_rate <- fore$Estimate
controls <- c("control climate-critical protected areas", "control climate-smart forestry: manage",
"control climate-smart farming", "control forest and wetland restoration")
fore$tx <- ifelse(fore$intervention%in%controls, 0, 1)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
"climate-critical protected areas", NA)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
"climate-smart forestry: manage", futuredf$int)
futuredf$int <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
"climate-smart farming", futuredf$int)
futuredf$int <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
"forest and wetland restoration", futuredf$int)
fore$costperint <- ave(fore$costperyr, fore$intervention, fore$year, FUN=sum)
cols <-viridis_pal(option="viridis")(4)
invest.fore <- ggplot(fore) +
geom_smooth(se=TRUE, aes(x=year, y=costperint/1000, col=int),
method="auto", level=0.5) +
theme_classic() + scale_color_manual(name="Intervention", values=cols,
labels=c("climate-critical protected areas"=
"climate-critical\nprotected areas",
"climate-smart farming"="cimate-smart\nfarming",
"climate-smart forestry:manage"="climate-smart\nforestry",
"forest and wetland restoration"="forest and\nwetland restoration")) +
ylab("Total investments ($1K)") + xlab("")
invest.fore
invest.fore <- ggplot(futuredf) +
geom_smooth(se=TRUE, aes(x=year, y=costperint/1000, col=int),
method="auto", level=0.5) +
theme_classic() + scale_color_manual(name="Intervention", values=cols,
labels=c("climate-critical protected areas"=
"climate-critical\nprotected areas",
"climate-smart farming"="cimate-smart\nfarming",
"climate-smart forestry:manage"="climate-smart\nforestry",
"forest and wetland restoration"="forest and\nwetland restoration")) +
ylab("Total investments ($1K)") + xlab("")
invest.fore
runApp()
View(futuredf)
ccpaprojs <- as.numeric(numccpa)
csfprojs <- as.numeric(numcsf)
csfarmprojs <- as.numeric(numcsfarm)
restoreprojs <- as.numeric(numrestore)
futuredf <- data.frame(intervention=c(rep("climate-critical protected areas", ccpaprojs),
rep("control climate-critical protected areas", ccpaprojs),
rep("climate-smart forestry: manage", csfprojs),
rep("control climate-smart forestry: manage", csfprojs),
rep("climate-smart farming", csfprojs),
rep("control climate-smart farming", csfprojs),
rep("forest and wetland restoration", restoreprojs),
rep("control forest and wetland restoration", restoreprojs)))
ccpayears <- as.numeric(rep(c(2022:2031), each=round(((ccpaprojs)/10), digits=0)))
csfyears <- as.numeric(rep(c(2022:2031), each=round(((csfprojs)/10), digits=0)))
csfarmyears <- as.numeric(rep(c(2022:2031), each=round(((csfarmprojs)/10), digits=0)))
restoreyears <- as.numeric(rep(c(2022:2031), each=round(((restoreprojs)/10), digits=0)))
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
ccpayears, NA)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
csfyears, futuredf$start)
futuredf$start <- ifelse(futuredf$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
restoreyears, futuredf$start)
futuredf$end <- futuredf$start + 4
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, year)
futdf <- rbind(futdf, fooadd)
}
params <- newbrazilbase[newbrazilbase$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
futdf <- futdf[complete.cases(futdf),]
for(i in c(1:nrow(futdf))){ #i=1
futdf$mst[i] <- rnorm(1, futdf$mst[i] + 0, 0.05)
futdf$pdsi[i] <- rnorm(1, futdf$pdsi[i] - 0, 0.05)
#futdf$pas[i] <- rnorm(1, futdf$pas[i], 0.1)
#futdf$numrds[i] <- rnorm(1, futdf$numrds[i], 50)
futdf$cost[i] <- 0 #+ ((futdf$start[i]-2020)*1000)
}
if(TRUE){
for(i in c(1:nrow(futdf))){
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-critical protected areas",
futdf$cost[i] + ((ccpainvest*1000000)/ccpaprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-smart forestry: manage",
futdf$cost[i] + ((csfinvest*1000000)/csfprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="climate-smart farming",
futdf$cost[i] + ((csfarminvest*1000000)/csfarmprojs),
futdf$cost[i])
futdf$cost[i] <- ifelse(futdf$intervention[i]=="forest and wetland restoration",
futdf$cost[i] + ((restoreinvest*1000000)/restoreprojs),
futdf$cost[i])
}
}
brazil <- futdf[!duplicated(futdf),]
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control climate-critical protected areas", "control climate-smart forestry: manage",
"control climate-smart farming", "control forest and wetland restoration")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$accum.cost <- ave(brazil.stan$costperyr, brazil.stan$start, brazil.stan$end, brazil.stan$intervention,
FUN=cumsum)
#### Let's explore rate of temperature and precip changes
brazil.stan <- brazil.stan %>%
group_by(intervention, start, end, cost) %>%
arrange(year) %>%
dplyr::mutate(prevpdsi = lag(pdsi, default = first(pdsi))) %>%
dplyr::mutate(prevmst = lag(mst, default = first(mst)))
brazil.stan <- brazil.stan[brazil.stan$yrsofproject>0,]
brazil.stan$mstrate <- (brazil.stan$mst-brazil.stan$prevmst) ## Annual rate of change
brazil.stan$pdsirate <- (brazil.stan$pdsi-brazil.stan$prevpdsi) ## annual rate of change
brazilsub <- brazil.stan[brazil.stan$year <= brazil.stan$end,]
brazilsub$yrsofproject <- ifelse(brazilsub$intervention %in% controls, 0, brazilsub$yrsofproject)
brazilsub$yrs.z <- (brazilsub$yrsofproject-mean(brazilsub$yrsofproject,na.rm=TRUE))/(2*sd(brazilsub$yrsofproject,na.rm=TRUE))
brazilsub$mst.z <- (brazilsub$mst-mean(brazilsub$mst,na.rm=TRUE))/(2*sd(brazilsub$mst,na.rm=TRUE))
brazilsub$pdsi.z <- (brazilsub$pdsi-mean(brazilsub$pdsi,na.rm=TRUE))/(2*sd(brazilsub$pdsi,na.rm=TRUE))
brazilsub$rds.z <- (brazilsub$numrds-mean(brazilsub$numrds,na.rm=TRUE))/(2*sd(brazilsub$numrds,na.rm=TRUE))
brazilsub$elev.z <- (brazilsub$elev-mean(brazilsub$elev,na.rm=TRUE))/(2*sd(brazilsub$elev,na.rm=TRUE))
brazilsub$slope.z <- (brazilsub$slope-mean(brazilsub$slope,na.rm=TRUE))/(2*sd(brazilsub$slope,na.rm=TRUE))
brazilsub$pas.z <- (brazilsub$pas-mean(brazilsub$pas,na.rm=TRUE))/(2*sd(brazilsub$pas,na.rm=TRUE))
brazilsub$acc.cost.z <- (brazilsub$accum.cost-mean(brazilsub$accum.cost,na.rm=TRUE))/(2*sd(brazilsub$accum.cost,na.rm=TRUE))
brazilsub$mstrate.z <- (brazilsub$mstrate-mean(brazilsub$mstrate,na.rm=TRUE))/(2*sd(brazilsub$mstrate,na.rm=TRUE))
brazilsub$prate.z <- (brazilsub$pdsirate-mean(brazilsub$pdsirate,na.rm=TRUE))/(2*sd(brazilsub$pdsirate,na.rm=TRUE))
##### Predict response now instead with new data...
newdat <- brazilsub
mylist <- list(newdat)
fore <- newdat
preddata <- predict(mod1, fore, allow_new_levels=TRUE, probs=c(0.25, 0.75), re_formula=NULL)
preddata <- as.data.frame(preddata)
fore <- cbind(fore, preddata)
fore$lc_ha_rate <- fore$Estimate
controls <- c("control climate-critical protected areas", "control climate-smart forestry: manage",
"control climate-smart farming", "control forest and wetland restoration")
fore$tx <- ifelse(fore$intervention%in%controls, 0, 1)
fore$int <- ifelse(fore$intervention %in% c("climate-critical protected areas",
"control climate-critical protected areas"),
"climate-critical protected areas", NA)
fore$int <- ifelse(fore$intervention %in% c("climate-smart forestry: manage",
"control climate-smart forestry: manage"),
"climate-smart forestry: manage", fore$int)
fore$int <- ifelse(fore$intervention %in% c("climate-smart farming",
"control climate-smart farming"),
"climate-smart farming", fore$int)
fore$int <- ifelse(fore$intervention %in% c("forest and wetland restoration",
"control forest and wetland restoration"),
"forest and wetland restoration", fore$int)
fore$costperint <- ave(fore$costperyr, fore$int, fore$year, FUN=sum)
cols <-viridis_pal(option="viridis")(4)
invest.fore <- ggplot(fore) +
geom_smooth(se=TRUE, aes(x=year, y=costperint/1000, col=int),
method="auto", level=0.5) +
theme_classic() + scale_color_manual(name="Intervention", values=cols,
labels=c("climate-critical protected areas"=
"climate-critical\nprotected areas",
"climate-smart farming"="cimate-smart\nfarming",
"climate-smart forestry:manage"="climate-smart\nforestry",
"forest and wetland restoration"="forest and\nwetland restoration")) +
ylab("Total investments ($1K)") + xlab("")
invest.fore
fore$accumcost.mil <- fore$accum.cost/1000000
rawinvest <- ggplot(fore[fore$tx==1,], aes(x = accumcost.mil, y = lc_ha_rate, col=intervention)) +
geom_smooth(method="lm", level=0.5, aes(fill=intervention)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
xlab("Investment (1M USD)") + ylab("Rate of natural land cover change")
rawyears <- ggplot(fore[fore$tx==1,], aes(x = yrsofproject, y = lc_ha_rate, col=intervention)) +
geom_smooth(method="lm", level=0.5, aes(fill=intervention)) + theme_classic() +
geom_hline(yintercept = 0, linetype="dotted") +
scale_color_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
scale_fill_manual(name="Intervention",
labels=sort(unique(fore$intervention[fore$tx==1])),
values=cols) +
xlab("Years of project") + ylab("Rate of natural land cover change")
grid.arrange(invest.fore, ncol=1)
grid.arrange(rawinvest, rawyears, ncol=2)
runApp()
